<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preparing the Migration &mdash; Solace Tools r0.0.2 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/contentui.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/contentui.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Details" href="../details.html" />
    <link rel="prev" title="General" href="general.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Solace Tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Packages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ep-openapi/index.html">Solace Event Portal OpenAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ep-rt-openapi/index.html">Solace Event Portal Runtime OpenAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ep-apim-openapi/index.html">Solace Event Portal APIM OpenAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ep-v1-openapi/index.html">Solace Event Portal V1 OpenAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sempv2-config-openapi/index.html">Solace SempV2 Config OpenAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ep-asyncapi/index.html">Solace Event Portal AsyncAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ep-sdk/index.html">Solace Event Portal SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ep-async-api-importer/index.html">Solace Event Portal Async API Importer</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Solace Event Portal Migrate V1 to V2</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../install.html">Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../usage.html">Usage</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="general.html">General</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Preparing the Migration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tokens">Tokens</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-file">Configuration File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-test-migration">Run Test Migration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fixing-issues-during-tests">Fixing Issues during Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#undo-test-migration">Undo Test Migration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-migration">Run Migration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../details.html">Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#resources">Resources</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference-doc/tsdocs.html">TypeScript TypeDoc</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Solace Tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Solace Event Portal Migrate V1 to V2</a></li>
          <li class="breadcrumb-item"><a href="../usage.html">Usage</a></li>
      <li class="breadcrumb-item active">Preparing the Migration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/ep-migrate/usage-content/migrate.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="preparing-the-migration">
<span id="ep-migrate-usage-content-migrate"></span><h1>Preparing the Migration<a class="headerlink" href="#preparing-the-migration" title="Permalink to this heading"></a></h1>
<div class="section" id="tokens">
<h2>Tokens<a class="headerlink" href="#tokens" title="Permalink to this heading"></a></h2>
<p>You can migrate from / to different EP accounts. This is controlled through</p>
<blockquote>
<div><ul class="simple">
<li><p>the EP V1 api base url and the the EP V1 token</p></li>
<li><p>the EP V2 api base url and the the EP V2 token</p></li>
</ul>
</div></blockquote>
<p>Assuming both use the default base url (<cite>https://api.solace.cloud</cite>), create two tokens:</p>
<ul class="simple">
<li><p>{EP V1 Token} (read access to all objects)</p></li>
<li><p>{EP V2 Token} (read &amp; write access to all objects)</p></li>
</ul>
<p>Export both as environment variables:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">EP_V1_SOLACE_CLOUD_TOKEN</span><span class="o">={</span>EP<span class="w"> </span>V1<span class="w"> </span>Token<span class="o">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">EP_V2_SOLACE_CLOUD_TOKEN</span><span class="o">={</span>EP<span class="w"> </span>V2<span class="w"> </span>Token<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="configuration-file">
<h2>Configuration File<a class="headerlink" href="#configuration-file" title="Permalink to this heading"></a></h2>
<p>Donwload the sample configuration file <a class="reference download internal" download="" href="../../_downloads/1baab147ca7e944ed2013d666f764b03/ep-migrate-sample-config.yaml"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>
and rename it to <cite>ep-migrate-config.yaml</cite>.</p>
<p>Adjust the contents to your needs.</p>
</div>
</div>
<div class="section" id="run-test-migration">
<h1>Run Test Migration<a class="headerlink" href="#run-test-migration" title="Permalink to this heading"></a></h1>
<p>It is recommended to run a test first, using an <cite>applicationDomainPrefix</cite>, for example:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">migrate</span><span class="p">:</span>
<span class="w">  </span><span class="nt">epV2</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># applicationDomainPrefix:</span>
<span class="w">    </span><span class="c1"># - optional</span>
<span class="w">    </span><span class="c1"># - if specified, prepends applicationDomainPrefix to all created applicationDomains</span>
<span class="w">    </span><span class="nt">applicationDomainPrefix</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;epV1/&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>For a test run it is also recommended to use the following <cite>logger</cite> settings, as they help with issue investigation and readability of the log file:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">logger</span><span class="p">:</span>
<span class="w">  </span><span class="nt">logSummary2Console</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">logLevel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
<span class="w">  </span><span class="nt">prettyPrint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</div></blockquote>
<p>Run the test migration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ep-migrate
</pre></div>
</div>
<p>Inspect the console output for details and any issues.</p>
<p>The details of the run are logged into the configured log file, for example <cite>./logs/ep-migrate.log</cite>.</p>
<div class="section" id="fixing-issues-during-tests">
<h2>Fixing Issues during Tests<a class="headerlink" href="#fixing-issues-during-tests" title="Permalink to this heading"></a></h2>
<p>At the end of the migration run, the encountered issues are logged to the console with their <cite>issueId</cite>.</p>
<p>To see the details of each issue:</p>
<ul class="simple">
<li><p>copy the <cite>issueId</cite></p></li>
<li><p>search for the <cite>issueId</cite> in the log file</p></li>
</ul>
<p>Once you have resolved any issues, e.g. by adjusting an object in EP V1, you can run the CLI again without the need to undo the migration first.
The CLI works in an idempotent manner and will only update objects/versions that have changed, hence saving time.</p>
</div>
<div class="section" id="undo-test-migration">
<h2>Undo Test Migration<a class="headerlink" href="#undo-test-migration" title="Permalink to this heading"></a></h2>
<p>If the migration was successful and you want to remove the create objects/versions from EP V2 again, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ep-migrate<span class="w"> </span>-rs<span class="w"> </span>absent
</pre></div>
</div>
<p>This will delete all Application Domains starting with the <cite>applicationDomainPrefix</cite>.</p>
<p>If instead you only want to undo the migration for a specific <cite>runId</cite>, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ep-migrate<span class="w"> </span>-rs<span class="w"> </span>absent<span class="w"> </span>-absentRunId<span class="w"> </span><span class="o">{</span>the-run-id<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-migration">
<h1>Run Migration<a class="headerlink" href="#run-migration" title="Permalink to this heading"></a></h1>
<p>Remove the <cite>applicationDomainPrefix</cite> from the config:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">migrate</span><span class="p">:</span>
<span class="w">  </span><span class="nt">epV2</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># applicationDomainPrefix:</span>
<span class="w">    </span><span class="c1"># - optional</span>
<span class="w">    </span><span class="c1"># - if specified, prepends applicationDomainPrefix to all created applicationDomains</span>
<span class="w">    </span><span class="c1"># applicationDomainPrefix: &#39;epV1/&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>Run the migration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ep-migrate
</pre></div>
</div>
<p>If you want to undo the migration, you now must use the <cite>runId</cite> from the previous run, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ep-migrate<span class="w"> </span>-rs<span class="w"> </span>absent<span class="w"> </span>-absentRunId<span class="w"> </span><span class="o">{</span>the-run-id<span class="o">}</span>
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="general.html" class="btn btn-neutral float-left" title="General" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../details.html" class="btn btn-neutral float-right" title="Details" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Solace Corporation.
      <span class="lastupdated">Last updated on 04 Oct 2023 at 19:34.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>